<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Data Preprocessing &#8212; Forecasting framework 1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=56c4699f" />
    <script src="../_static/documentation_options.js?v=29a6c3e3"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Performance Measurement" href="performance_measurement.html" />
    <link rel="prev" title="Data Loader" href="data_loader.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="data-preprocessing">
<h1>Data Preprocessing<a class="headerlink" href="#data-preprocessing" title="Link to this heading">¶</a></h1>
<p>This module is equipped with the <cite>DataPreprocessor</cite> class, specifically designed for the preprocessing of time series data
for machine learning models.
A method for data splitting is present, that uses processed dates coming from the <cite>DataLoader</cite> object.
The class contains also specific methods for tasks such as managing missing values,
removing non-numeric columns, managing outliers, and appropriately scaling data.
These methods are designed taking into account the sequential nature of time series data, providing moving windows for outlier detection
and making sure that, if a dataset with a large sequence of NaN is detected, the code stops working due to the lack of
useful data. Also, data scaling is applied to the test set by using statistics from the training set, avoiding thus data leakage.
The class supports various operational modes like training, testing, and fine-tuning.</p>
<dl class="py class" id="module-data_preprocessing">
<dt class="sig sig-object py" id="data_preprocessing.DataPreprocessor">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">data_preprocessing.</span></span><span class="sig-name descname"><span class="pre">DataPreprocessor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_ext</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">run_mode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dates</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scaling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">folder_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#data_preprocessing.DataPreprocessor" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class to handle operations of preprocessing, including tasks such as managing NaN values,
removing non-numeric columns, splitting datasets, managing outliers, and scaling data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_ext</strong> – File extension for saving datasets.</p></li>
<li><p><strong>run_mode</strong> – Mode of operation (‘train’, ‘test’, ‘train_test’, ‘fine_tuning’).</p></li>
<li><p><strong>model_type</strong> – Type of machine learning model to prepare data for.</p></li>
<li><p><strong>df</strong> – DataFrame containing the data.</p></li>
<li><p><strong>target_column</strong> – Name of the target column in the DataFrame.</p></li>
<li><p><strong>dates</strong> – Indexes of dates given by command line with –date_list.</p></li>
<li><p><strong>scaling</strong> – Boolean flag to determine if scaling should be applied.</p></li>
<li><p><strong>validation</strong> – Boolean flag to determine if a validation set should be created.</p></li>
<li><p><strong>train_size</strong> – Proportion of data to be used for training.</p></li>
<li><p><strong>val_size</strong> – Proportion of data to be used for validation.</p></li>
<li><p><strong>test_size</strong> – Proportion of data to be used for testing.</p></li>
<li><p><strong>folder_path</strong> – Path to folder for saving data.</p></li>
<li><p><strong>model_path</strong> – Path to model file for loading or saving the model.</p></li>
<li><p><strong>verbose</strong> – Boolean flag for verbose output.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="data_preprocessing.DataPreprocessor.conditional_print">
<span class="sig-name descname"><span class="pre">conditional_print</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#data_preprocessing.DataPreprocessor.conditional_print" title="Link to this definition">¶</a></dt>
<dd><p>Print messages conditionally based on the verbose attribute.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – Non-keyword arguments to be printed</p></li>
<li><p><strong>kwargs</strong> – Keyword arguments to be printed</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="data_preprocessing.DataPreprocessor.detect_nan_hole">
<span class="sig-name descname"><span class="pre">detect_nan_hole</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#data_preprocessing.DataPreprocessor.detect_nan_hole" title="Link to this definition">¶</a></dt>
<dd><p>Detects the largest contiguous NaN hole in the target column.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>df</strong> – DataFrame in which to find the NaN hole</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary with the start and end indices of the largest NaN hole in the target column</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="data_preprocessing.DataPreprocessor.manage_nan">
<span class="sig-name descname"><span class="pre">manage_nan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_nan_percentage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_nan_percentage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percent_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">40</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#data_preprocessing.DataPreprocessor.manage_nan" title="Link to this definition">¶</a></dt>
<dd><p>Manage NaN values in the dataset based on defined percentage thresholds and interpolation strategies.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – Dataframe to analyze</p></li>
<li><p><strong>max_nan_percentage</strong> – Maximum allowed percentage of NaN values for a column to be interpolated or kept</p></li>
<li><p><strong>min_nan_percentage</strong> – Minimum percentage of NaN values for which linear interpolation is applied</p></li>
<li><p><strong>percent_threshold</strong> – Threshold percentage of NaNs in the target column to decide between interpolation and splitting the dataset</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple (df, exit), where df is the DataFrame after NaN management, and exit is a boolean flag indicating if the dataset needs to be split</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="data_preprocessing.DataPreprocessor.preprocess_data">
<span class="sig-name descname"><span class="pre">preprocess_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#data_preprocessing.DataPreprocessor.preprocess_data" title="Link to this definition">¶</a></dt>
<dd><p>Main method to preprocess the dataset according to specified configurations.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Depending on the mode, returns the splitted dataframe and an exit flag.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="data_preprocessing.DataPreprocessor.print_stats">
<span class="sig-name descname"><span class="pre">print_stats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#data_preprocessing.DataPreprocessor.print_stats" title="Link to this definition">¶</a></dt>
<dd><p>Print statistics for the selected feature in the training dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>train</strong> – DataFrame containing the training data</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="data_preprocessing.DataPreprocessor.replace_outliers">
<span class="sig-name descname"><span class="pre">replace_outliers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#data_preprocessing.DataPreprocessor.replace_outliers" title="Link to this definition">¶</a></dt>
<dd><p>Replaces outliers in the dataset based on the Interquartile Range (IQR)
method. Instead of analyzing the entire dataset at once, this method focuses on a window of data points at a time.
The window moves through the data series step by step. For each step, it includes the next data point
in the sequence while dropping the oldest one, thus maintaining a constant
window size. For each position of the window, the function calculates the
first (Q1) and third (Q3) quartiles of the data within the window. These
quartiles are used to determine the Interquartile Range (IQR), from which
lower and upper bounds for outliers are derived.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>df</strong> – DataFrame from which to remove and replace outliers</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DataFrame with outliers replaced</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="data_preprocessing.DataPreprocessor.split_data">
<span class="sig-name descname"><span class="pre">split_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#data_preprocessing.DataPreprocessor.split_data" title="Link to this definition">¶</a></dt>
<dd><p>Split the dataset into training, validation, and test sets.
If a list with dates is given, each set is created within the respective dates, otherwise the sets are created following
the given percentage sizes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>df</strong> – DataFrame to split</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple of DataFrames for training, testing, and validation</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="data_preprocessing.DataPreprocessor.split_file_at_nanhole">
<span class="sig-name descname"><span class="pre">split_file_at_nanhole</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nan_hole</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#data_preprocessing.DataPreprocessor.split_file_at_nanhole" title="Link to this definition">¶</a></dt>
<dd><p>Splits the dataset at a significant NaN hole into two separate files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>nan_hole</strong> – Dictionary containing start and end indices of the NaN hole in the target column</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Forecasting framework</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="forecasting_framework.html">Forecasting Framework</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_loader.html">Data Loader</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Preprocessing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data_preprocessing.DataPreprocessor"><code class="docutils literal notranslate"><span class="pre">DataPreprocessor</span></code></a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="performance_measurement.html">Performance Measurement</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="time_series_analysis.html">Time Series Analysis</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">Utilities</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ARIMA_model.html">ARIMA Model</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="SARIMA_model.html">SARIMA Model</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="XGB_model.html">XGB Model</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="LSTM_model.html">LSTM Model</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="NAIVE_model.html">NAIVE Model</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="parser_arguments.html">Parser Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="parser_arguments.html#usage-examples">Usage Examples</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="data_loader.html" title="previous chapter">Data Loader</a></li>
      <li>Next: <a href="performance_measurement.html" title="next chapter">Performance Measurement</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Gianluca Ferro.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.0.2</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/docs/data_preprocessing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>